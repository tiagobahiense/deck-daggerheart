/* =========================================================
   TABLETOP VIRTUAL (V8.0 - FULLSCREEN GM & CONTROLS)
   ========================================================= */

/* --- ÁREA GERAL --- */
#tabletop-area {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    overflow: hidden; background-color: #050505; z-index: 0; display: none;
}

#map-container {
    position: absolute; 
    transform-origin: top left;
    box-shadow: 0 0 50px rgba(0,0,0,0.8); 
    cursor: grab;
    top: 0; left: 0;
}
#map-container:active { cursor: grabbing; }

.map-bg-img { 
    display: block; pointer-events: none; 
    max-width: none !important; width: auto !important; height: auto !important;
}

.grid-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
    background-size: 50px 50px;
    background-image: linear-gradient(to right, rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                      linear-gradient(to bottom, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
    z-index: 10;
}

/* --- MODO FULLSCREEN (JOGADOR E MESTRE EXPANDIDO) --- */
.modo-jogador #tabletop-area,
#tabletop-area.gm-fullscreen {
    position: fixed !important; top: 0; left: 0; width: 100vw; height: 100vh;
    z-index: 6000 !important; /* Acima de tudo */
    background: #000;
    display: flex !important; align-items: center; justify-content: center;
}

/* Centralização no modo fullscreen */
.modo-jogador #map-container,
#tabletop-area.gm-fullscreen #map-container {
    position: relative !important;
    top: auto !important; left: auto !important;
    cursor: default !important;
    box-shadow: none !important;
    display: flex; align-items: center; justify-content: center;
}

.modo-jogador .map-bg-img,
#tabletop-area.gm-fullscreen .map-bg-img {
    max-width: 100% !important; max-height: 100% !important;
    width: auto !important; height: auto !important;
    object-fit: contain;
}

/* Botão de Fechar/Minimizar para o Mestre no Fullscreen */
#btn-exit-fullscreen {
    display: none;
    position: fixed; top: 20px; right: 20px; z-index: 7000;
    background: rgba(0,0,0,0.8); color: var(--gold); border: 2px solid var(--gold);
    padding: 10px 20px; font-weight: bold; cursor: pointer; border-radius: 5px;
}
#tabletop-area.gm-fullscreen ~ #btn-exit-fullscreen { display: block; }

/* Oculta UI desnecessária no fullscreen */
body.vtt-ativo #mao-area,
body.vtt-ativo #deck-container-wrapper,
body.vtt-ativo #reserva-area,
body.vtt-ativo #mesa-area { display: none !important; }

/* --- TOKENS --- */
.token {
    position: absolute; width: 50px; height: 50px; border-radius: 50%;
    background-size: cover; 
    background-position: center top; /* Foca no rosto */
    background-repeat: no-repeat;
    background-color: #000;
    box-shadow: 0 0 5px #000; cursor: grab; z-index: 20;
    border: 2px solid transparent; transition: transform 0.1s;
}
.token:active { cursor: grabbing; }
.token:hover { transform: scale(1.2); z-index: 100; border-color: #fff; }

/* Token Invisível (apenas mestre vê translúcido) */
.token.oculto { opacity: 0.5; filter: grayscale(1); border-style: dashed; }

.token.token-jogador { border-color: #00ff00; box-shadow: 0 0 10px #00ff00; }
.token.token-monstro { border-color: #ff0000; }

/* Barras */
.token-bars-container {
    position: absolute; bottom: -14px; left: -10%; width: 120%;
    display: flex; flex-direction: column; gap: 2px; pointer-events: none;
    background: rgba(0,0,0,0.7); padding: 2px; border-radius: 4px; z-index: 101;
}
.bar-track { width: 100%; height: 5px; background: #300; border: 1px solid #000; }
.fill-hp { height: 100%; background: #0f0; width: 100%; transition: width 0.3s; }
.fill-pf { height: 100%; background: #08f; width: 100%; transition: width 0.3s; }

/* --- MODAL DE OPÇÕES DO TOKEN (DUPLO CLIQUE) --- */
.token-options-modal {
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: #111; border: 2px solid var(--gold);
    padding: 15px; border-radius: 10px; z-index: 8000; width: 280px;
    box-shadow: 0 0 50px #000; display: none; color: #fff;
}
.token-options-header {
    text-align: center; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 10px;
    font-weight: bold; color: var(--gold); font-size: 1.1rem;
}
.token-control-row {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
    background: #222; padding: 5px; border-radius: 5px;
}
.token-control-label { color: #aaa; font-size: 0.85rem; }

.btn-ctrl {
    background: #333; border: 1px solid #555; color: white;
    width: 30px; height: 30px; cursor: pointer; border-radius: 4px;
    display: flex; align-items: center; justify-content: center; font-weight: bold;
}
.btn-ctrl:hover { background: #555; border-color: var(--gold); }

.btn-delete-token {
    width: 100%; background: #400; border: 1px solid #f00; color: #fff;
    padding: 8px; cursor: pointer; margin-top: 10px; border-radius: 5px;
}
.btn-delete-token:hover { background: #600; }

.eye-toggle { font-size: 1.2rem; cursor: pointer; opacity: 0.3; }
.eye-toggle.visible { opacity: 1; text-shadow: 0 0 5px #0f0; }

/* Botões do Jogador */
#btn-vtt-toggle {
    position: fixed; top: 10px; right: 80px; z-index: 10000;
    background: rgba(0,0,0,0.8); color: var(--gold); border: 1px solid var(--gold);
    padding: 5px 10px; cursor: pointer; border-radius: 5px; display: none;
}