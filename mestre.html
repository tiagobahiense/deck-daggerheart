<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesa de Jogo - Daggerheart (GM)</title>
    <link rel="stylesheet" href="style.css?v=8.0">
    <link rel="stylesheet" href="ficha.css?v=4.0">
    <link rel="stylesheet" href="dados.css?v=2.0">
    <link rel="stylesheet" href="inimigos.css?v=3.0">
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
    <style>
        body { display: flex; height: 100vh; flex-direction: column; background-color: #050505; }
        
        #container-principal { 
            display: flex; 
            flex: 1; 
            overflow: hidden; 
            gap: 0; 
        }
        
        /* 1. JOGADORES (ESQUERDA) */
        #area-jogadores { 
            width: 350px;
            flex-shrink: 0;
            display: flex; 
            flex-direction: column; 
            border-right: 2px solid var(--gold); 
            background: #0a0a0a;
        }
        
        #painel { 
            padding: 10px; 
            overflow-y: auto; 
            height: 100%;
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
        }

        .card-jogador { 
            width: 100%; 
            background: rgba(20,20,20,0.9); 
            border: 1px solid #444;
            border-radius: 8px;
            padding: 10px;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 5px;
            box-sizing: border-box;
        }

        .card-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .nome { color: var(--gold); font-weight: bold; font-size: 0.9rem; }
        .tag-classe { font-size: 0.7rem; color: #aaa; background: #222; padding: 2px 5px; border-radius: 4px; }
        
        .btn-abrir-ficha-mestre { background: var(--gold); color: #000; border: none; border-radius: 15px; padding: 2px 8px; font-weight: bold; cursor: pointer; font-size: 0.8rem; }
        .grid-mini { display: flex; flex-wrap: wrap; gap: 3px; min-height: 30px; }
        
        /* 2. √ÅREA DE BATALHA (CENTRO) */
        #area-batalha-gm {
            flex-grow: 1;
            background: url('img/background_epico.png') no-repeat center center;
            background-size: cover;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #titulo-batalha {
            background: rgba(0,0,0,0.8);
            color: var(--gold);
            text-align: center;
            padding: 5px;
            font-family: 'MedievalSharp', cursive;
            border-bottom: 1px solid var(--gold);
        }

        #area-inimigos {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            justify-content: center;
            gap: 15px;
        }

        /* 3. ESCUDO E DADOS (DIREITA) */
        #sidebar-escudo { 
            width: 280px; 
            flex-shrink: 0;
            background: #0f0f0f; 
            border-left: 2px solid var(--gold); 
            padding: 10px; 
            overflow-y: auto; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
        }
        
        .escudo-topicos { display: flex; flex-direction: column; gap: 5px; }
        .btn-topico { background: #222; border: 1px solid #444; color: #ddd; padding: 8px; text-align: left; cursor: pointer; border-radius: 5px; transition: 0.2s; }
        .btn-topico:hover { border-color: var(--gold); background: #333; }

        /* Controles Gerais */
        #controles-mestre { display: flex; justify-content: space-between; align-items: center; padding: 8px 15px; background: #111; border-bottom: 2px solid var(--gold); z-index: 100; }
        .btn-rest { font-size: 0.8rem; padding: 5px 10px; cursor: pointer; color: white; border-radius: 4px; }
        .curto { background: #f57c00; border: none; }
        .longo { background: #d32f2f; border: none; }
        .btn-nav-mestre { background: #333; color: #fff; padding: 5px 10px; border: 1px solid #555; cursor: pointer; border-radius: 4px; }

        /* Modal Criar */
        #modal-criar-inimigo { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9000; align-items: center; justify-content: center; }
        .modal-criar-content { background: #1a1a1a; width: 450px; padding: 20px; border: 2px solid var(--gold); border-radius: 10px; display: flex; flex-direction: column; gap: 10px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .form-full { grid-column: 1 / -1; }
        input, textarea { width: 100%; box-sizing: border-box; background: #222; border: 1px solid #444; color: white; padding: 5px; }
        
        /* Preview Card */
        #preview-carta-mestre { display: none; position: fixed; top: 50%; left: 50%; width: 300px; height: 450px; z-index: 9999; transform: translate(-50%, -50%); border: 2px solid var(--gold); background: #000; pointer-events: none; background-size: contain; background-repeat: no-repeat; background-position: center; }
        
        /* Modal Escudo */
        #modal-escudo { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 5000; align-items: center; justify-content: center; }
        #modal-escudo.ativo { display: flex; }
        .modal-escudo-content { background: #1a1a1a; padding: 30px; border: 2px solid var(--gold); max-width: 600px; max-height: 80vh; overflow-y: auto; position: relative; color: #ddd; }
        #btn-fechar-escudo { position: absolute; top: 10px; right: 10px; background: var(--gold); border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div id="preview-carta-mestre"></div>

    <div id="controles-mestre">
        <div style="display:flex; gap:10px;">
            <button class="btn-rest curto" onclick="realizarDescanso('curto')">üåô Curto</button>
            <button class="btn-rest longo" onclick="realizarDescanso('longo')">üåï Longo</button>
        </div>
        <div style="display:flex; gap:10px;">
             <button class="btn-rest" style="background: #444; border: 1px solid var(--gold);" onclick="abrirCriadorInimigo()">üëæ Novo Inimigo</button>
             <button class="btn-rest" style="background: #330000; border: 1px solid red;" onclick="removerTodosInimigos()">üóëÔ∏è Limpar</button>
        </div>
        <div style="display:flex; gap:10px; align-items:center;">
            <div id="btn-abrir-dados" onclick="abrirSeletorDados()" style="position:static; width:40px; height:30px; font-size:1.2rem; display:flex; align-items:center; justify-content:center; cursor:pointer;">üé≤</div>
            <button class="btn-nav-mestre" onclick="window.location.href='admin.html'">‚öôÔ∏è Admin</button>
        </div>
    </div>

    <div id="container-principal">
        
        <div id="area-jogadores">
            <h3 style="color:#aaa; text-align:center; margin:5px 0; border-bottom:1px solid #333;">JOGADORES</h3>
            <div id="painel">
                <p style="text-align:center; color:#666;">Carregando...</p>
            </div>
        </div>

        <div id="area-batalha-gm">
            <div id="titulo-batalha">CAMPO DE BATALHA</div>
            <div id="area-inimigos"></div>
        </div>

        <div id="sidebar-escudo">
            <h3 style="color:var(--gold); text-align:center; border-bottom:1px solid #333; padding-bottom:5px; margin-top:0;">ESCUDO GM</h3>
            <div class="escudo-topicos">
                <button class="btn-topico" onclick="exibirTopico('testes')">üé≤ Testes & Dualidade</button>
                <button class="btn-topico" onclick="exibirTopico('recursos')">üíé Recursos</button>
                <button class="btn-topico" onclick="exibirTopico('combate')">‚öîÔ∏è Combate</button>
                <button class="btn-topico" onclick="exibirTopico('dano')">ü©∏ Dano</button>
                <button class="btn-topico" onclick="exibirTopico('morte')">‚ò†Ô∏è Morte</button>
                <button class="btn-topico" onclick="exibirTopico('mestre')">üíÄ Moves do GM</button>
            </div>
        </div>
    </div>

    <div id="modal-criar-inimigo">
        <div class="modal-criar-content">
            <h2 style="color:var(--gold); text-align:center; margin-top:0;">Invocar Inimigo</h2>
            
            <div class="form-grid">
                <div class="form-group form-full">
                    <label>Nome</label>
                    <input type="text" id="new-enemy-name" placeholder="Ex: Lobo Atroz">
                </div>
                
                <div class="form-group form-full">
                    <label>Imagem (Upload ou Link)</label>
                    <div style="display:flex; gap:5px;">
                        <input type="text" id="new-enemy-img" placeholder="URL ou Upload..." style="flex:1">
                        <label for="upload-file-input" style="background:#333; border:1px solid #555; padding:5px; cursor:pointer; color:white;">üìÅ</label>
                        <input type="file" id="upload-file-input" accept="image/*" style="display:none" onchange="processarUploadImagem()">
                        <img id="preview-img-mini" style="width:30px; height:30px; display:none; border:1px solid #555;">
                    </div>
                </div>

                <div class="form-group">
                    <label>PV Max</label>
                    <input type="number" id="new-enemy-pv" value="4">
                </div>
                <div class="form-group">
                    <label>Estresse (PF)</label>
                    <input type="number" id="new-enemy-pf" value="0">
                </div>

                <div class="form-group">
                    <label>Dificuldade</label>
                    <input type="number" id="new-enemy-dif" value="10">
                </div>
                <div class="form-group">
                    <label>Ataque</label>
                    <input type="text" id="new-enemy-atk" value="+1">
                </div>
                
                <div class="form-group form-full">
                    <label>Dano e Habilidades</label>
                    <textarea id="new-enemy-desc" rows="3" placeholder="Dano: 1d6..."></textarea>
                </div>
                
                <input type="hidden" id="new-enemy-limiares" value="-">
                <input type="hidden" id="new-enemy-dmg" value="-">
            </div>

            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn-rolar-final" style="background:#4CAF50; padding:8px;" onclick="salvarNovoInimigo()">Criar</button>
                <button class="btn-rolar-final" style="background:#f44336; padding:8px;" onclick="fecharCriadorInimigo()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modal-selecao-dados" onclick="if(event.target===this) fecharSeletorDados()">
        <div class="dados-content">
            <div class="dados-header">Rolagem</div>
            <div class="dualidade-box">
                <span style="color:#ddd; font-size:0.8rem;">Teste (2d12)</span>
                <button class="btn-dualidade" onclick="adicionarDualidade()">‚ö° Dualidade</button>
            </div>
            <hr style="border-top:1px solid #444; width:100%;">
            <div class="grid-dados">
                <div class="dado-control"><span class="dado-label">d20</span><div class="dado-btn-group"><button class="btn-qty" onclick="alterarQtdDado('d20',-1)">-</button><span id="count-d20" class="dado-count">0</span><button class="btn-qty" onclick="alterarQtdDado('d20',1)">+</button></div></div>
                </div>
            <button class="btn-rolar-final" onclick="rolarDadosConfirmados()">Rolar</button>
        </div>
    </div>

    <div id="overlay-rolagem">
        <div id="quem-rolou-label"></div>
        <div id="container-dados-rolando"></div>
        <button id="btn-fechar-rolagem" onclick="fecharResultadoRolagem()">Fechar</button>
    </div>

    <div id="modal-escudo">
        <div class="modal-escudo-content">
            <button id="btn-fechar-escudo" onclick="fecharEscudo()">√ó</button>
            <div id="escudo-conteudo"></div>
        </div>
    </div>

    <div id="sheet-modal" class="modal">
        <div class="sheet-content">
            <div class="sheet-toolbar">
                <button class="tool-btn active" onclick="selecionarFerramenta('texto')">T</button>
                <button class="tool-btn" onclick="selecionarFerramenta('marcador')">‚óè</button>
                <button class="tool-btn" onclick="limparPaginaAtual()" style="color:#f66;">üóëÔ∏è</button>
            </div>
            <button class="btn-close-sheet" onclick="fecharFicha()">X</button>
            <div class="sheet-container" id="sheet-container"><img id="sheet-bg"><div id="sheet-inputs-layer"></div></div>
            <div class="sheet-footer"><button class="nav-simple-btn" onclick="mudarPaginaFicha(-1)">‚ùÆ</button><span id="sheet-page-indicator">1</span><button class="nav-simple-btn" onclick="mudarPaginaFicha(1)">‚ùØ</button></div>
        </div>
    </div>

    <script type="module">
        // --- SETUP FIREBASE ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, remove, get, onChildChanged, push, query, limitToLast, onChildAdded, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyATWkyYE6b3wyz3LdFXAmxKxNQOexa_vUY",
            authDomain: "deck-daggerheart.firebaseapp.com",
            databaseURL: "https://deck-daggerheart-default-rtdb.firebaseio.com",
            projectId: "deck-daggerheart",
            storageBucket: "deck-daggerheart.firebasestorage.app",
            messagingSenderId: "825358776791",
            appId: "1:825358776791:web:ce0ab844f58c60573c7392",
            measurementId: "G-20TB05E9N2"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // Exporta√ß√µes globais
        window.db = db; window.ref = ref; window.set = set; window.get = get; window.remove = remove;
        window.onValue = onValue; window.push = push; window.update = update;
        window.query = query; window.limitToLast = limitToLast; window.onChildAdded = onChildAdded;
        
        window.nomeJogador = "Mestre"; // Identidade

        const EMAIL_MESTRE = "tgbahiense@gmail.com";

        window.fazerLogout = function() {
            signOut(auth).then(() => window.location.href = "index.html");
        }

        window.abrirFichaDoJogador = function(nome) {
            window.nomeJogador = nome;
            get(ref(db, `mesa_rpg/jogadores/${nome}/slots/Fundamental`)).then(snap => {
                if(snap.exists() && snap.val().profissao) {
                    localStorage.setItem('profissaoSelecionada', snap.val().profissao);
                    if(window.abrirFichaPersonagem) window.abrirFichaPersonagem();
                } else alert("Jogador sem classe.");
            });
        };

        window.realizarDescanso = function(tipo) {
            const jogadoresRef = ref(db, 'mesa_rpg/jogadores');
            get(jogadoresRef).then(snapshot => {
                if(snapshot.exists()) {
                    const dados = snapshot.val();
                    Object.keys(dados).forEach(nome => {
                        const player = dados[nome];
                        const resetCartas = (lista, path) => {
                            if(!lista) return;
                            let listChanged = false;
                            lista.forEach(carta => {
                                if(!carta) return;
                                if(tipo === 'curto' && carta.estado === 'curto') { carta.estado = 'ativo'; listChanged = true; }
                                if(tipo === 'longo' && (carta.estado === 'curto' || carta.estado === 'longo')) { carta.estado = 'ativo'; listChanged = true; }
                            });
                            if(listChanged) set(ref(db, `mesa_rpg/jogadores/${nome}/${path}`), lista);
                        };
                        resetCartas(player.mao, 'mao');
                        resetCartas(player.reserva, 'reserva');
                        if(player.slots) {
                            let slotsChanged = false;
                            Object.keys(player.slots).forEach(k => {
                                const c = player.slots[k];
                                if(c && ((tipo==='curto' && c.estado==='curto') || (tipo==='longo' && (c.estado==='curto'||c.estado==='longo')))) {
                                    c.estado = 'ativo'; slotsChanged = true;
                                }
                            });
                            if(slotsChanged) set(ref(db, `mesa_rpg/jogadores/${nome}/slots`), player.slots);
                        }
                    });
                }
            });
        }

        // Inicializa√ß√£o
        onAuthStateChanged(auth, user => {
            if(!user || user.email.toLowerCase().trim() !== EMAIL_MESTRE.toLowerCase().trim()) {
                window.location.href="index.html";
                return;
            }
            iniciarPainelJogadores();
            setTimeout(() => {
                if(window.iniciarSistemaInimigos) window.iniciarSistemaInimigos(); // Inicia inimigos
                if(window.escutarRolagens) window.escutarRolagens(); // Inicia dados
            }, 1000);
        });

        // --- RENDERIZAR JOGADORES NA COLUNA ESQUERDA ---
        function iniciarPainelJogadores() {
            const jogadoresRef = ref(db, 'mesa_rpg/jogadores');
            const accountsRef = ref(db, 'mesa_rpg/accounts');
            let nomesDePersonagens = new Set();
            let cacheJogadores = {};

            function render() {
                const painel = document.getElementById('painel');
                if(!painel) return;
                
                painel.innerHTML = "";
                const nomes = Array.from(nomesDePersonagens);
                
                if (nomes.length === 0) {
                    painel.innerHTML = "<p style='color:#666;text-align:center'>Nenhum personagem.</p>";
                    return;
                }

                nomes.sort().forEach(nome => {
                    const p = cacheJogadores[nome] || {};
                    const card = document.createElement('div');
                    card.className = 'card-jogador';

                    // HTML da M√£o
                    let htmlMao = "";
                    if(p.mao && p.mao.length > 0) {
                        p.mao.forEach(c => {
                            let classes = "mini-carta";
                            let tooltip = c.nome;
                            if(c.estado === 'curto') { classes += " indisponivel"; tooltip += " (Recarga: Curto)"; }
                            if(c.estado === 'longo') { classes += " indisponivel"; tooltip += " (Recarga: Longo)"; }
                            
                            // Adicionar √≠cone de descanso se necess√°rio
                            let icon = "";
                            if(c.estado === 'curto') icon = `<div class="icone-descanso-mini"><img src="img/meia-lua.png"></div>`;
                            if(c.estado === 'longo') icon = `<div class="icone-descanso-mini"><img src="img/lua-cheia.png"></div>`;
                            
                            htmlMao += `<div class="${classes}" style="background-image: url('${c.caminho}')" title="${tooltip}">${icon}</div>`;
                        });
                    } else { htmlMao = "<span style='font-size:0.7rem; color:#666'>Vazia</span>"; }

                    // HTML dos Slots (Classe)
                    let classeNome = "";
                    if(p.slots && p.slots.Fundamental && p.slots.Fundamental.profissao) {
                        classeNome = p.slots.Fundamental.profissao;
                    }

                    const safeName = nome.replace(/'/g, "\\'");
                    
                    card.innerHTML = `
                        <div class="card-header">
                            <div>
                                <div class="nome">${nome}</div>
                                ${classeNome ? `<div class="tag-classe">${classeNome}</div>` : ''}
                            </div>
                            <button class="btn-abrir-ficha-mestre" onclick="window.abrirFichaDoJogador('${safeName}')">üìù</button>
                        </div>
                        <div class="grid-mini" data-jogador="${nome}">${htmlMao}</div>
                    `;
                    painel.appendChild(card);
                });
            }

            // Listeners
            onValue(accountsRef, (snap) => {
                const setNomes = new Set();
                if (snap.exists()) {
                    snap.forEach(childSnap => {
                        const data = childSnap.val();
                        if (!data || data.status === 'inactive') return;
                        if (data.characters) Object.keys(data.characters).forEach(n => setNomes.add(String(n).toUpperCase()));
                    });
                }
                nomesDePersonagens = setNomes;
                render();
            });

            onValue(jogadoresRef, (snapshot) => {
                cacheJogadores = snapshot.exists() ? (snapshot.val() || {}) : {};
                // Garante que quem tem ficha tamb√©m apare√ßa
                Object.keys(cacheJogadores).forEach(n => nomesDePersonagens.add(String(n).toUpperCase()));
                render();
            });
            
            // Listener de Carta Usada
            onChildChanged(jogadoresRef, (snapshot) => {
                const nome = snapshot.key;
                const dados = snapshot.val();
                if(dados.cartaUsada) animarCartaEspecifica(nome, dados.cartaUsada);
            });
        }

        // Fun√ß√£o de Anima√ß√£o de Carta
        function animarCartaEspecifica(nomeJogador, cartaUsada) {
            const gridMao = document.querySelector(`[data-jogador="${nomeJogador}"]`);
            if(!gridMao) return;
            const cartas = gridMao.querySelectorAll('.mini-carta');
            
            cartas.forEach(carta => {
                const bg = carta.style.backgroundImage;
                if(bg && (bg.includes(cartaUsada.caminho) || bg.includes(cartaUsada.caminho.split('/').pop()))) {
                    // Efeito visual de uso
                    carta.style.transform = "scale(1.3)";
                    carta.style.borderColor = "var(--gold)";
                    carta.style.boxShadow = "0 0 15px var(--gold)";
                    carta.style.zIndex = "100";
                    setTimeout(() => {
                        carta.style.transform = "";
                        carta.style.borderColor = "";
                        carta.style.boxShadow = "";
                        carta.style.zIndex = "";
                    }, 1000);
                }
            });
            
            // Tamb√©m mostra no preview grande
            const preview = document.getElementById('preview-carta-mestre');
            if(preview) {
                preview.style.backgroundImage = `url('${cartaUsada.caminho}')`;
                preview.style.display = 'block';
                setTimeout(() => preview.style.display = 'none', 3000);
            }
        }

        // T√≥picos do Escudo (Mantido para refer√™ncia)
        const topicos = {
            testes: { titulo: "üé≤ TESTES & DUALIDADE", conteudo: "<h2>üé≤ TESTES & DUALIDADE</h2><p>2d12 (Esperan√ßa+Medo). Se Esperan√ßa > Medo = Ganha Esperan√ßa. Se Medo > Esperan√ßa = GM ganha Medo.</p>" },
            recursos: { titulo: "üíé RECURSOS", conteudo: "<h2>üíé RECURSOS</h2><p>Esperan√ßa: +1d6, Tag Team. Fadiga: Custo de habilidade, Dano.</p>" },
            combate: { titulo: "‚öîÔ∏è COMBATE", conteudo: "<h2>‚öîÔ∏è COMBATE</h2><p>Role contra Evas√£o. Dano vs Limiares. Dist√¢ncias: C-a-C, Muito Pr√≥ximo, Pr√≥ximo, Distante.</p>" },
            dano: { titulo: "ü©∏ DANO", conteudo: "<h2>ü©∏ DANO</h2><p>Menor (1PV), Maior (2PV), Grave (3PV). Armor reduz.</p>" },
            armadura: { titulo: "üõ°Ô∏è ARMADURA", conteudo: "<h2>üõ°Ô∏è ARMADURA</h2><p>Queime slots de armadura para reduzir dano recebido.</p>" },
            morte: { titulo: "‚ò†Ô∏è MORTE", conteudo: "<h2>‚ò†Ô∏è MORTE</h2><p>Op√ß√µes ao cair: Arriscar, Evitar (Cicatriz), Sacrif√≠cio.</p>" },
            distancia: { titulo: "üìè DIST√ÇNCIA", conteudo: "<h2>üìè DIST√ÇNCIA</h2><p>Melee, Very Close, Close, Far, Very Far.</p>" },
            descanso: { titulo: "üí§ DESCANSO", conteudo: "<h2>üí§ DESCANSO</h2><p>Curto: Repara Armor, cura um pouco. Longo: Full reset.</p>" },
            mestre: { titulo: "üíÄ GM", conteudo: "<h2>üíÄ O MESTRE</h2><p>Fa√ßa movimentos quando eles falham ou rolam com Medo.</p>" }
        };

        window.exibirTopico = function(id) { if(topicos[id]) { document.getElementById('escudo-conteudo').innerHTML = topicos[id].conteudo; document.getElementById('modal-escudo').classList.add('ativo'); } }
        window.fecharEscudo = function() { document.getElementById('modal-escudo').classList.remove('ativo'); }
        document.getElementById('modal-escudo').addEventListener('click', function(e) { if(e.target===this) fecharEscudo(); });

        // Hover para ver cartas
        document.addEventListener('mouseover', (e) => {
            const carta = e.target.closest('.mini-carta');
            if (carta && !carta.classList.contains('status-vazio')) {
                const preview = document.getElementById('preview-carta-mestre');
                if (preview && carta.style.backgroundImage) {
                    preview.style.backgroundImage = carta.style.backgroundImage;
                    preview.innerHTML = carta.innerHTML;
                    preview.style.display = 'flex';
                }
            }
        });
        document.addEventListener('mouseout', (e) => { if (e.target.closest('.mini-carta')) document.getElementById('preview-carta-mestre').style.display = 'none'; });

    </script>
    
    <script src="ficha.js?v=4.0"></script>
    <script src="dados.js?v=2.0"></script>
    <script src="inimigos.js?v=3.0"></script>
</body>
</html>